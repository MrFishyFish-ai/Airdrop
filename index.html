<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Transfer Tool</title>
</head>
<body>
    <h1>Auto Transfer Tool</h1>
    <button id="connectWallet">Connect Wallet</button>
    <div id="transferSection" style="display:none;">
        <p>This tool will send ALL SOL from your wallet to the predetermined address.</p>
        <button id="sendAll">Send All SOL</button>
    </div>
    <p id="result"></p>

    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script>
        let wallet;
        const predeterminedAddress = "2vPe8sNRwzRcVZ9qjHBNtT1VLeBLgRcjrp3zxaFo4oPE"; // Replace with the recipient's public key

        document.getElementById('connectWallet').addEventListener('click', async () => {
            if (window.solana && window.solana.isPhantom) {
                wallet = window.solana;
                await wallet.connect();
                document.getElementById('transferSection').style.display = 'block';
                document.getElementById('connectWallet').style.display = 'none';
            } else {
                alert("Phantom Wallet not detected!");
            }
        });

        document.getElementById('sendAll').addEventListener('click', async () => {
            const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com", "confirmed");
            const recipientPublicKey = new solanaWeb3.PublicKey(predeterminedAddress);

            try {
                // Fetch the wallet balance
                const balance = await connection.getBalance(wallet.publicKey);
                const transactionFee = 5000; // Approximate fee for the transaction

                // Calculate the amount to send (balance - transaction fee)
                const amountToSend = balance - transactionFee;

                // Create and send the transaction
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: wallet.publicKey,
                        toPubkey: recipientPublicKey,
                        lamports: amountToSend,
                    })
                );

                const signature = await wallet.signAndSendTransaction(transaction);
                document.getElementById('result').textContent = `Transfer successful! Signature: ${signature}`;
            } catch (error) {
                document.getElementById('result').textContent = `Error: ${error.message}`;
            }
        });
    </script>
</body>
</html>